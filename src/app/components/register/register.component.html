<div class="register-container container">
	<div mymicds-blur class="register-header">
		<h1>Register</h1>
		<div class="step-count">
			<div *ngFor="let x of [0, 1, 2, 3, 4, 5]" mymicds-blur class="dot" [class.filled]="x < step" [class.curr]="x === step"></div>
		</div>
	</div>

    <div class="register-form">
		<div class="step-wrapper" *ngIf="step === 0" @flyInOut>
			<form mymicds-blur novalidate
				[formGroup]="registerForms[0]"
				(ngSubmit)="nextStep()"
				class="form-username form-group"
				[class.has-warning]="registerForms[0].controls.user.dirty && !isAlphabetic(registerForms[0].controls.user.value)">
				<div>
					<h1 class="display-3">Username</h1>
					<hr>
				</div>
				<div class="register-inputs">
					<div class="input-group username-input">
						<input class="form-control form-control-lg"
							[class.form-control-warning]="registerForms[0].controls.user.dirty && !isAlphabetic(registerForms[0].controls.user.value)"
							formControlName="user"
							placeholder="Username">

						<div class="input-group-addon">@micds.org</div>
					</div>
					<p class="form-control-feedback">Your username is the prefix of your MICDS email. <strong>Do not add the '@micds.org' to your username.</strong></p>
				</div>

				<div class="register-footer">
					<button class="btn btn-primary btn-lg btn-block" [disabled]="!registerForms[0].valid || step !== 0">Next</button>
				</div>
			</form>
		</div>

		<div class="step-wrapper" *ngIf="step === 1" @flyInOut>
			<form [formGroup]="registerForms[1]" (ngSubmit)="nextStep()" novalidate mymicds-blur class="form-group">
				<div>
					<h1 class="display-3">Password</h1>
					<hr class="my-2">
				</div>
				
				<div class="register-inputs register-content">
					<input type="password" class="form-control form-control-lg" formControlName="password" placeholder="Password">
					<input type="password" class="form-control form-control-lg" formControlName="confirmPassword" placeholder="Confirm Password">
					<div *ngIf="registerForms[1].errors?.mismatchedPasswords" class="form-control-feedback text-danger">Passwords do not match</div>
					<p class="form-control-feedback">MyMICDS.net is not affiliated with Mary Institute and Saint Louis Country Day School. We recommend you use a different password than your normal school one. <a routerLink="/about" fragment="disclaimer">Learn more here!</a></p>
				</div>

				<div class="register-footer">
					<button type="submit" class="btn btn-primary btn-lg btn-block" [disabled]="!registerForms[1].valid || step !== 1">Next</button>
				</div>
			</form>
		</div>

		<div class="step-wrapper" *ngIf="step === 2" @flyInOut>
			<form [formGroup]="registerForms[2]" (ngSubmit)="nextStep()" novalidate mymicds-blur class="form-group" [class.has-danger]="(registerForms[2].controls.firstName.dirty && !registerForms[2].controls.firstName.valid) || (registerForms[2].controls.lastName.dirty && !registerForms[2].controls.lastName.valid)">
				<div>
					<h1 class="display-3">Name</h1>
					<hr class="my-2">
				</div>
				
				<div class="register-inputs register-content">
					<div class="full-name form-inline">
						<div>
							<!-- <label for="firstName">First</label> -->
							<input id="firstName" class="form-control form-control-lg" [class.form-control-danger]="registerForms[2].controls.firstName.dirty && !registerForms[2].controls.firstName.valid" formControlName="firstName" placeholder="First Name">
						</div>
						<div>
							<!-- <label for="lastName">Last</label> -->
							<input id="lastName" class="form-control form-control-lg" [class.form-control-danger]="registerForms[2].controls.lastName.dirty && !registerForms[2].controls.lastName.valid" formControlName="lastName" placeholder="Last Name">
						</div>
					</div>
					<p *ngIf="(registerForms[2].controls.firstName.dirty && !registerForms[2].controls.firstName.valid) || (registerForms[2].controls.lastName.dirty && !registerForms[2].controls.lastName.valid)" class="form-control-feedback">
						First name and last name are required.
					</p>
				</div>

				<div class="register-footer">
					<button type="submit" class="btn btn-primary btn-lg btn-block"  [disabled]="!registerForms[2].valid || step !== 2">Next</button>
				</div>
			</form>
		</div>

		<div class="step-wrapper" *ngIf="step === 3" @flyInOut>
			<form [formGroup]="registerForms[3]" (ngSubmit)="register()" novalidate mymicds-blur class="grad-year form-group">
				<div>
					<h1 class="display-3">Grade</h1>
					<hr class="my-2">
				</div>
				<div class="register-inputs register-content">
					<div class="teacher checkbox">
						<label class="form-check-label">
							<input class="form-check-input form-control-lg" type="checkbox" formControlName="teacher">
							I am a Teacher
						</label>
					</div>
					<div *ngIf="!registerForms[3]?.controls?.teacher.value" class="grade-spacer">
						<span class="line"></span>
						<span class="text">or</span>
						<span class="line"></span>
					</div>
					<div *ngIf="!registerForms[3]?.controls?.teacher.value" class="student">
						<span class="form-control-feedback">Choose your graduation year</span>
						<select class="form-control form-control-lg" formControlName="gradYear">
							<option *ngFor="let year of gradeRange" [value]="year">Class of {{year}}</option>
						</select>
					</div>
				</div>

				<div class="register-footer">
					<p class="text-danger" *ngIf="registerResponse !== true;">{{ registerResponse }}</p>
					<button type="submit" class="btn btn-primary btn-lg btn-block" [disabled]="!registerForms[3].valid || step !== 3">Next</button>
				</div>
			</form>
		</div>

		<div class="step-wrapper" *ngIf="step === 4" @flyInOut>
			<div class="form-group" mymicds-blur>
				<div>
					<h1 class="display-3">Email Confirmation</h1>
					<hr class="my-2">
				</div>
				<div class="register-inputs register-content">
					<!-- Loading Screen -->
					<div *ngIf="submitted && registerResponse === null" class="register-response">
						<h1 class="display-4">Sending Email...</h1>
					</div>
					<!-- Success Response -->
					<div *ngIf="submitted && registerResponse === true" class="register-response">
						<h1 class="display-4">Confirmation Email Sent! <i class="fa fa-check"></i></h1>
						<p>Please wait a few minutes for the email to come through. If it isn't in your inbox, check your spam.</p>
						<a class="gmail btn btn-info btn-lg" href="https://mail.google.com">Take me to Gmail</a>
					</div>
					<!-- Failure Response -->
					<div *ngIf="submitted && typeOf(registerResponse) === 'string'" class="register-response">
						<h1 class="display-4">{{registerResponse}} <i class="fa fa-times"></i></h1>
						<p><a (click)="resubmitForm()">Try again</a> or contact support if an unexpected error keeps happening.</p>
					</div>
				</div>
				<div class="register-footer">
					<button class="btn btn-primary btn-lg btn-block" [disabled]="step !== 4 || registerResponse !== true" (click)="nextStep()">Next</button>
				</div>
			</div>
		</div>

		<div class="step-wrapper" *ngIf="step === 5" @flyInOut>
			<div class="form-group" mymicds-blur>
				<div>
					<h1 class="display-3">Getting Started</h1>
					<hr class="my-2">
				</div>
				<div class="register-inputs register-content">
					<mymicds-url></mymicds-url>
				</div>
				<div class="register-footer" *ngIf="urlComp">
						<button [routerLink]="'/home'" class="btn btn-primary btn-lg" [disabled]="!urlComp.canvasValid || !urlComp.portalValid || !urlComp.canvasURL || !urlComp.portalURL || step !== 5">All Done</button>
						<button [routerLink]="'/home'" class="btn btn-warning btn-lg" [disabled]="step !== 5">Skip this step</button>
				</div>
			</div>
		</div>
        <!-- <button class="btn btn-primary btn-lg btn-block" [disabled]="!registerForm.valid">Register</button> -->
    </div>
</div>
